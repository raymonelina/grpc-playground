# gRPC Bidirectional Streaming - Scripts Directory

This directory contains build, execution, and testing scripts for the gRPC bidirectional streaming playground.

## Core Scripts

### Build Scripts
- `build-all.sh` - Master build script for all languages
- `build-java.sh` - Build Java projects with Maven
- `build-cpp.sh` - Build C++ projects with CMake
- `build-rust.sh` - Build Rust projects with Cargo
- `generate-proto.sh` - Generate protobuf code for all languages

### Execution Scripts
- `run-server.sh` - Start gRPC servers (Java, C++, or Rust)
- `run-client.sh` - Run gRPC clients (Java, C++, or Rust)

### Testing Scripts
- `test-interop.sh` - Full interoperability test suite (all 9 combinations)
- `test-runner.sh` - Comprehensive test runner with various test modes
- `verify-generation.sh` - Verify generated protobuf code compiles

## Quick Start

### 1. Build Everything
```bash
./scripts/build-all.sh
```

### 2. Test Basic Functionality
```bash
./scripts/test-runner.sh smoke
```

### 3. Run Interoperability Tests
```bash
./scripts/test-interop.sh
```

## Detailed Usage

### Build Operations

#### Build all languages
```bash
./scripts/build-all.sh                    # Build all
./scripts/build-all.sh all clean          # Clean all
./scripts/build-all.sh all rebuild        # Clean and rebuild all
```

#### Build specific language
```bash
./scripts/build-java.sh build             # Build Java
./scripts/build-cpp.sh clean              # Clean C++
./scripts/build-rust.sh rebuild           # Clean and rebuild Rust
```

#### Generate protobuf code
```bash
./scripts/generate-proto.sh               # Generate all
./scripts/generate-proto.sh clean all     # Clean all generated code
./scripts/generate-proto.sh regenerate java  # Clean and regenerate Java
```

### Running Servers and Clients

#### Start a server
```bash
./scripts/run-server.sh java              # Java server on port 50051
./scripts/run-server.sh rust 8080         # Rust server on port 8080
./scripts/run-server.sh cpp 9090          # C++ server on port 9090
```

#### Run a client
```bash
./scripts/run-client.sh java              # Java client with defaults
./scripts/run-client.sh rust localhost 8080  # Rust client to port 8080
./scripts/run-client.sh cpp localhost 50051 "laptop" "B001" "gaming laptop"
```

### Testing

#### Quick tests
```bash
./scripts/test-runner.sh                  # Smoke tests
./scripts/test-runner.sh structure        # Verify project structure
./scripts/test-runner.sh build java       # Test Java build
./scripts/test-runner.sh server rust      # Test Rust server startup
```

#### Interoperability tests
```bash
./scripts/test-interop.sh                 # All 9 combinations
./scripts/test-interop.sh test java rust  # Specific combination
./scripts/test-runner.sh quick-interop    # Quick interop test
./scripts/test-runner.sh full-interop     # Full interop test
```

#### Comprehensive testing
```bash
./scripts/test-runner.sh all              # All tests
```

## Script Features

### Enhanced Build Scripts
- **Clean and rebuild functionality** - All build scripts support `clean`, `build`, and `rebuild` actions
- **Colored output** - Status messages with color coding for better visibility
- **Error handling** - Proper error detection and reporting
- **Dependency checking** - Verify required tools are installed
- **Cross-platform compatibility** - Works on macOS, Linux, and Windows (with WSL)

### Execution Scripts
- **Multi-language support** - Run servers and clients in Java, C++, or Rust
- **Port management** - Automatic port availability checking
- **Parameter validation** - Input validation with helpful error messages
- **Server health checks** - Verify server is running before client connections
- **Graceful shutdown** - Proper cleanup on interruption

### Testing Framework
- **Comprehensive test coverage** - From smoke tests to full interoperability
- **Automated test execution** - Run all combinations automatically
- **Result tracking** - Detailed test results and logging
- **Timeout handling** - Prevent hanging tests
- **Log preservation** - Failed test logs saved for debugging

## Generated Files

### Java
- **Location**: `java/generated/ads/` and `java/target/generated-sources/protobuf/`
- **Files**: `Ads.java`, `AdsServiceGrpc.java`
- **Build System**: Maven with protobuf-maven-plugin
- **Dependencies**: gRPC Java, Protocol Buffers

### C++
- **Location**: `cpp/generated/` and `cpp/build/generated/`
- **Files**: `ads.pb.h/cc`, `ads.grpc.pb.h/cc`
- **Build System**: CMake with custom protoc commands
- **Dependencies**: gRPC C++, Protocol Buffers
- **Output**: Static library `libads_proto.a`

### Rust
- **Location**: Generated during build in `rust/target/debug/build/*/out/`
- **Files**: `ads.rs` (generated by tonic-build)
- **Build System**: Cargo with build.rs scripts
- **Dependencies**: tonic, prost, tokio

## Prerequisites

### Required Tools
- **Protocol Buffers compiler** (`protoc`)
- **gRPC plugins** for each language
- **Language-specific tools**:
  - Java: Maven (`mvn`) or Gradle (`gradle`)
  - C++: CMake (`cmake`) and C++ compiler (`g++` or `clang++`)
  - Rust: Cargo (`cargo`)

### Optional Tools (for testing)
- `lsof` - Port checking
- `nc` (netcat) - Network connectivity testing
- `timeout` - Command timeout handling

### Installation Examples

#### macOS (Homebrew)
```bash
brew install protobuf grpc cmake maven
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

#### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install -y protobuf-compiler libgrpc++-dev cmake maven
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

## Project Structure

```
scripts/
├── README.md              # This file
├── generate-proto.sh      # Protobuf code generation
├── build-java.sh         # Java build script
├── build-cpp.sh          # C++ build script  
├── build-rust.sh         # Rust build script
├── build-all.sh          # Master build script
├── run-server.sh         # Server execution script
├── run-client.sh         # Client execution script
├── test-interop.sh       # Interoperability test suite
├── test-runner.sh        # Comprehensive test runner
└── verify-generation.sh  # Verification script

java/
├── pom.xml               # Maven configuration
├── generated/            # Standalone protoc output
├── src/main/java/        # Implementation code
└── target/               # Maven build output

cpp/
├── CMakeLists.txt        # CMake configuration
├── generated/            # Standalone protoc output
├── client/               # Client implementation
├── server/               # Server implementation
└── build/                # CMake build output

rust/
├── Cargo.toml            # Workspace configuration
├── client/               # Client project with build.rs
├── server/               # Server project with build.rs
└── target/               # Cargo build output
```

## Troubleshooting

### Common Issues

1. **"protoc not found"**
   - Install Protocol Buffers compiler
   - Ensure `protoc` is in your PATH

2. **"gRPC plugin not found"**
   - Install language-specific gRPC plugins
   - Check plugin paths in scripts

3. **Build failures**
   - Run `./scripts/test-runner.sh structure` to verify project structure
   - Check language-specific build tool installation

4. **Server startup failures**
   - Check if port is already in use
   - Verify build completed successfully
   - Check firewall settings

5. **Client connection failures**
   - Ensure server is running
   - Verify port numbers match
   - Check network connectivity

### Debug Mode
Most scripts support verbose output. Check the script source for debug options or run with `bash -x` for detailed execution traces:

```bash
bash -x ./scripts/build-all.sh
```

## Implementation Notes

### Java
- Uses Maven with protobuf-maven-plugin for integrated builds
- Supports both standalone protoc generation and Maven-integrated generation
- Auto-creates pom.xml if not present

### C++
- Uses CMake with custom commands for protobuf generation
- Handles pkg-config for finding gRPC and protobuf dependencies
- Creates static library for generated code

### Rust
- Uses tonic-build in build.rs scripts for code generation
- Workspace configuration with separate client/server projects
- Code generation happens automatically during cargo build

### Cross-Language Compatibility
- All implementations use the same proto/ads.proto file
- Generated code is compatible across language boundaries
- Supports full bidirectional streaming as defined in the protocol

## Contributing

When adding new scripts:
1. Follow the existing naming convention
2. Include help/usage information
3. Add colored output for status messages
4. Implement proper error handling
5. Update this README with new script documentation